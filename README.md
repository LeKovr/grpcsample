# companyserv

## 1. Описание

Сервис на golang, предоставляющий gRPC API. API сервиса, включая все структуры запросов, ответов и коды ошибок описаны в [protobuf](api.proto)

## 2. Требования к Сервису

1. сервис должен работать в отдельной БД (Postgresql) с заданной структурой таблиц (схема данных - [companyserv.sql](companyserv.sql)
2. сервис должен конфигурироваться (хост бд, пользователь, адрес интерфейса gRPC и т.д.) через задание опций командной строки. 
3. методы GetCUserPolicies и UpdateCUserPolicies реализовать заглушками, возвращающими всегда пустой ответ без ошибки.

## 3. TODO

* [ ] поддержка timestamp (google.protobuf.Timestamp, gogoproto, [protobuild](https://github.com/stevvooe/protobuild/)? )
* [ ] подходит ли go-pg для фильтров и остального?
* [ ] как отключить поля с префиксом `XXX_` для go-pg?
* [ ] зачем зашито имя пользователя (ma)?

## 4. Нюансы

* формулировка `X СОДЕРЖИТ указанный текст` неоднозначна, буквально это `LIKE %X%`, но в большинстве случаев лучше `~* X`
* В .proto нет метода создания записи в user, решено в addon.sql

## 4. Расширения

* [ ] тесты: режим одной транзакции
* [ ] тесты grpc
* [ ] моки?
